<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="css/user.css">
</head>

<body>
  <button>动态创建表格</button>
  <div id="box1">
    <!-- <table> -->
    <!-- <caption>就业榜</caption>
      <thead>
        <tr>
          <th>姓名</th>
          <th>年龄</th>
          <th>性别</th>
          <th>学号</th>
          <th>薪资</th>
          <th>城市</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>欧阳霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>上海</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>令狐霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>北京</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>诸葛霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>南京</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>西门霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>深圳</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>上官霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>北京</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>欧阳霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>上海</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>令狐霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>北京</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>诸葛霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>南京</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>西门霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>深圳</td>
          <td><a herf="#">删除</a></td>
        </tr>
        <tr>
          <td>上官霸天</td>
          <td>19</td>
          <td>男</td>
          <td>1001</td>
          <td>20000</td>
          <td>北京</td>
          <td><a herf="#">删除</a></td>
        </tr>
      </tbody>
    </table> -->
  </div>
  <script>
    // - 根据给定的数据，动态创建表格
    //  - 点击“动态创建表格”按钮，根据页面中的数据创建表格，(第一个数组是用来创建表头的，第二个数组是用来创建表体的)
    //  - 如果页面中有一个表格，再点击"动态创建表格"按钮，不会再次创建表格，保证页面中有且只有一个表格
    //  - 点击每行中的"删除"，会弹出"你真的要删除嘛?",如果点击弹出框中的“确定”,那么就把对应的这一行删除，如果点击“取消”那么不删除
    //  - 当tbody中的行都被删除之后，这个表格也会被从页面中移除，再次点击“动态创建表格”继续可以创建表格
    // 后端的数据
    var heads = ['姓名', '年龄', '性别', '学号', '薪资', '城市', '操作'];
    var datas = [{
      name: '欧阳霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '上海'
    },
    {
      name: '令狐霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '北京'
    },
    {
      name: '诸葛霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '南京'
    },
    {
      name: '西门霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '深圳'
    },
    {
      name: '上官霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '北京'
    },
    {
      name: '欧阳霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '上海'
    },
    {
      name: '令狐霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '北京'
    },
    {
      name: '诸葛霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '南京'
    },
    {
      name: '西门霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '深圳'
    },
    {
      name: '上官霸天',
      age: 19,
      gender: '男',
      stuId: '1001',
      salary: '20000',
      city: '北京'
    },
    ];



    // 点击“动态创建表格”按钮，根据页面中的数据创建表格，(第一个数组是用来创建表头的，第二个数组是用来创建表体的)
    // 如果页面中有一个表格，再点击"动态创建表格"按钮，不会再次创建表格，保证页面中有且只有一个表格

    // 1.获取元素 按钮 box1 状态变量flag 为true
    let oBtn = document.querySelector('button');
    let oBox = document.querySelector('#box1');
    let flag = true;
    // 2.给按钮添加点击事件
    oBtn.onclick = function () {
      // 2.1 如果flag 为true 创建表格
      if (flag) {
        // 2.1.1 创建table
        let table = document.createElement('table');

        // 2.1.2  <caption>就业榜</caption>
        let caption = document.createElement('caption');
        caption.innerText = '就业榜';
        table.appendChild(caption);
        // 2.1.3 thead
        // 创建thead
        let thead = document.createElement('thead');
        // 创建thead中的tr
        let theadTr = document.createElement('tr');
        // 创建一个空字符串
        let thStr = '';
        // 拼接th
        for (let i = 0; i < heads.length; i++) {
          thStr += `<th>${heads[i]}</th>`;
        }
        // 把th写道thead中的tr里面
        theadTr.innerHTML = thStr;
        // 把tr放如thead
        thead.appendChild(theadTr);
        // 把thead放入table
        table.appendChild(thead);
        // 2.1.4 tbody
        let tbody = document.createElement('tbody');
        let str = '';
        // 2.1.4.1 使用for循环来遍历数几个tr
        for (let i = 0; i < datas.length; i++) {
          str += '<tr>'
          // 2.1.4.2 使用for in来遍历td
          for (let key in datas[i]) {
            str += `<td>${datas[i][key]}</td>`
          }
          str += '<td><a herf="#">删除</a></td></tr>'
        }
        tbody.innerHTML = str;
        table.appendChild(tbody);
        // 显示到页面上

        oBox.appendChild(table);
        flag = false;
      }

    }


    //  - 点击每行中的"删除"，会弹出"你真的要删除嘛?",如果点击弹出框中的“确定”,那么就把对应的这一行删除，如果点击“取消”那么不删除
    // 1.给oBox添加点击事件 进行事件委托
    oBox.onclick = function (e) {
      // console.dir(e.target);
      if (e.target.nodeName == 'A') {
        let result = confirm("您确定真的要删除吗");
        if (result) {
          // console.log(e.target);
          // console.log(e.target.parentNode.parentNode.parentNode);
          // e.target.parentNode.parentNode.parentNode  =>tbody
          // e.target.parentNode.parentNode  => tr
          e.target.parentNode.parentNode.parentNode.removeChild(e.target.parentNode.parentNode);
          // console.log(document.querySelectorAll('tbody tr'))
          // console.log(document.querySelectorAll('tbody tr').length)
          // if (document.querySelectorAll('tbody tr').length)
          // console.log(document.querySelector('table'));
          // 如果 tbody中 tr的个数已经是0了那么就用 obx删除table
          if (document.querySelectorAll('tbody tr').length == 0) {
            oBox.removeChild(document.querySelector('table'));
            flag = true;
          }
        }
      }


    }
    // 2.找到点击的目标对象的父元素(td)的父元素(tr)的父元素删除(目标对象的父元素(td)的父元素(tr))
    // 3.判断 tbody的子元素是否等于0 oBox.remove( 点击的目标对象的父元素(td)的父元素(tr)的父元素(tbody)的父元素(table))
    // 当tbody中的行都被删除之后，这个表格也会被从页面中移除，再次点击“动态创建表格”继续可以创建表格


  </script>
</body>

</html>